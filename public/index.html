<!DOCTYPE html>
<!-- Trivial Kapuchi v2.2 - Multijugador con Rondas - 2026-01-01 -->
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Trivial Kapuchi 2026 - Multijugador Actualizado</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 25%, #0f3460 50%, #533483 75%, #e94560 100%);
            background-size: 200% 200%;
            animation: gradientShift 20s ease infinite;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(30px);
            padding: 25px;
            border-radius: 30px;
            max-width: 600px;
            width: 90%;
            position: relative;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            max-height: 98vh;
            overflow-y: auto;
            z-index: 1;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        h1 { 
            text-align: center; 
            color: #ffffff;
            font-size: 48px;
            margin-bottom: 15px;
            font-weight: 900;
            text-shadow: 0 0 20px rgba(233, 69, 96, 0.8);
        }
        
        input, button {
            width: 100%;
            padding: 14px;
            margin: 8px 0;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
        }
        
        input {
            border: 3px solid rgba(102, 126, 234, 0.3);
            background: rgba(255, 255, 255, 0.9);
        }
        
        button {
            border: none;
            cursor: pointer;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        button:hover {
            transform: translateY(-3px);
        }
        
        .btn-primary { 
            background: linear-gradient(135deg, #ff6b6b 0%, #ff5252 100%);
        }
        
        .btn-secondary { 
            background: linear-gradient(135deg, #4ecdc4 0%, #44a3a0 100%);
        }
        
        .screen { display: none; }
        .screen.active { display: block; }
        
        .config-selector {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
            margin: 15px 0;
        }
        
        .config-btn {
            padding: 20px 10px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .config-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(233, 69, 96, 0.4);
        }
        
        .config-btn.selected {
            border-color: #e94560;
            background: linear-gradient(135deg, rgba(233, 69, 96, 0.3), rgba(233, 69, 96, 0.5));
            box-shadow: 0 0 20px rgba(233, 69, 96, 0.6);
            transform: scale(1.05);
        }
        
        .config-number {
            font-size: 32px;
            font-weight: 900;
            margin-bottom: 5px;
        }
        
        .config-label {
            font-size: 13px;
            font-weight: 600;
        }
        
        .room-code {
            background: #667eea;
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 32px;
            font-weight: bold;
            margin: 20px 0;
            letter-spacing: 5px;
        }
        
        .player { 
            padding: 10px; 
            margin: 5px 0; 
            background: white; 
            border-radius: 5px; 
        }
        
        .player.ready { 
            background: #4CAF50; 
            color: white; 
        }
        
        .error { 
            background: #f44336; 
            color: white; 
            padding: 10px; 
            border-radius: 5px; 
            margin: 10px 0; 
        }
        
        .question-text {
            font-size: 20px;
            font-weight: 700;
            margin: 15px 0;
            text-align: center;
            padding: 25px 20px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 18px;
            color: #ffffff;
            min-height: 90px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .timer {
            width: 140px;
            height: 140px;
            font-size: 64px;
            font-weight: 900;
            text-align: center;
            background: linear-gradient(135deg, #ff6b6b 0%, #ff0000 100%);
            color: #ffffff;
            margin: 15px auto;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 50px rgba(255, 0, 0, 1);
            border: 6px solid rgba(255, 255, 255, 0.5);
        }
        
        .option-btn {
            padding: 16px 20px;
            border: none;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.12);
            color: #ffffff;
            transition: all 0.3s;
            margin: 6px 0;
            width: 100%;
            text-align: left;
        }
        
        .option-btn:hover {
            transform: translateY(-4px);
            background: rgba(255, 255, 255, 0.2);
        }
        
        .option-btn.selected { 
            background: linear-gradient(135deg, #e94560 0%, #ff6b9d 100%) !important;
        }
        
        .option-btn.correct {
            background: linear-gradient(135deg, #06ffa5 0%, #00d4aa 100%) !important;
        }
        
        .option-btn.wrong {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%) !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="errorContainer"></div>
        
        <!-- PANTALLA INICIAL -->
        <div id="homeScreen" class="screen active">
            <h1>üéÆ Trivial Kapuchi</h1>
            <p style="text-align: center; color: rgba(255, 255, 255, 0.9); font-size: 16px; margin: 20px 0;">
                Pon a prueba tus conocimientos
            </p>
            
            <input type="text" id="playerName" placeholder="‚ú® Escribe tu nombre" maxlength="20">
            
            <button class="btn-primary" onclick="showMultiplayerConfig()">
                üåê Multijugador Online
            </button>
            
            <button class="btn-secondary" onclick="showJoinScreen()">
                üéØ Unirse a Partida
            </button>
        </div>
        
        <!-- PANTALLA CONFIGURACI√ìN MULTIJUGADOR -->
        <div id="multiplayerConfigScreen" class="screen">
            <h1>üåê Configurar Partida</h1>
            <h3 style="text-align: center; margin: 20px 0; color: rgba(255, 255, 255, 0.9);">
                Personaliza la experiencia
            </h3>
            
            <!-- SELECTOR DE RONDAS -->
            <div style="margin: 25px 0;">
                <h4 style="text-align: center; color: rgba(255, 255, 255, 0.95); margin-bottom: 12px;">
                    üîÑ N√∫mero de Rondas
                </h4>
                <div class="config-selector">
                    <div class="config-btn selected" onclick="selectMultiplayerRounds(1)" data-rounds="1">
                        <div class="config-number">1</div>
                        <div class="config-label">Ronda</div>
                    </div>
                    <div class="config-btn" onclick="selectMultiplayerRounds(2)" data-rounds="2">
                        <div class="config-number">2</div>
                        <div class="config-label">Rondas</div>
                    </div>
                    <div class="config-btn" onclick="selectMultiplayerRounds(3)" data-rounds="3">
                        <div class="config-number">3</div>
                        <div class="config-label">Rondas</div>
                    </div>
                </div>
            </div>
            
            <!-- SELECTOR DE PREGUNTAS -->
            <div style="margin: 25px 0;">
                <h4 style="text-align: center; color: rgba(255, 255, 255, 0.95); margin-bottom: 12px;">
                    ‚ùì Preguntas por Ronda
                </h4>
                <div class="config-selector">
                    <div class="config-btn" onclick="selectMultiplayerQuestions(5)" data-questions="5">
                        <div class="config-number">5</div>
                        <div class="config-label">R√°pido</div>
                    </div>
                    <div class="config-btn" onclick="selectMultiplayerQuestions(10)" data-questions="10">
                        <div class="config-number">10</div>
                        <div class="config-label">Medio</div>
                    </div>
                    <div class="config-btn selected" onclick="selectMultiplayerQuestions(15)" data-questions="15">
                        <div class="config-number">15</div>
                        <div class="config-label">Largo</div>
                    </div>
                </div>
            </div>
            
            <!-- RESUMEN -->
            <div style="background: rgba(255, 255, 255, 0.1); border-radius: 15px; padding: 20px; margin: 25px 0;">
                <div style="text-align: center; color: rgba(255, 255, 255, 0.95); font-size: 15px; margin-bottom: 8px;">
                    üìä <strong>Total:</strong> <span id="multiplayerTotalQuestions">15</span> preguntas por jugador
                </div>
                <div style="text-align: center; color: rgba(255, 255, 255, 0.8); font-size: 14px;">
                    ‚è±Ô∏è <strong>Tiempo estimado:</strong> <span id="multiplayerEstimatedTime">6</span> minutos
                </div>
            </div>
            
            <button class="btn-primary" onclick="createRoomWithConfig()">
                ‚ö° CREAR SALA
            </button>
            <button class="btn-secondary" onclick="showScreen('homeScreen')">Volver</button>
        </div>
        
        <!-- PANTALLA UNIRSE -->
        <div id="joinScreen" class="screen">
            <h1>üéØ Unirse a Partida</h1>
            <input type="text" id="playerName2" placeholder="Tu nombre" maxlength="20">
            <input type="text" id="roomCodeInput" placeholder="C√≥digo de sala" maxlength="6">
            <button class="btn-secondary" onclick="joinRoom()">Unirse</button>
            <button class="btn-secondary" onclick="showScreen('homeScreen')">Volver</button>
        </div>
        
        <!-- PANTALLA ESPERA -->
        <div id="waitingScreen" class="screen">
            <h1>‚è≥ Sala de Espera</h1>
            <div id="roomCodeDisplay" class="room-code"></div>
            <p style="text-align: center; color: rgba(255,255,255,0.8); margin: 10px 0;">
                <span id="playerCount">1</span>/4 jugadores ¬∑ M√≠nimo 2 para empezar
            </p>
            <div id="playersList"></div>
            <button class="btn-primary" id="readyBtn" onclick="markReady()">¬°Estoy Listo!</button>
            <button class="btn-secondary" onclick="location.reload()">Salir</button>
        </div>
        
        <!-- PANTALLA JUEGO -->
        <div id="gameScreen" class="screen">
            <div id="questionNumber" style="text-align: center; color: #fff; font-weight: 900; font-size: 18px; margin: 8px 0;"></div>
            
            <!-- MARCADOR EN VIVO -->
            <div id="liveScoreboard" style="text-align: center; margin: 10px 0; padding: 12px; background: rgba(0,0,0,0.3); border-radius: 12px; backdrop-filter: blur(10px);"></div>
            
            <div id="timer" class="timer">15</div>
            
            <div id="questionText" class="question-text"></div>
            
            <div id="optionsGrid"></div>
            
            <!-- POWER-UP 50/50 -->
            <div class="powerup-container" style="text-align: center; margin: 15px 0;">
                <button id="fiftyFiftyBtn" class="powerup-btn" onclick="useFiftyFifty()" title="Elimina 2 respuestas incorrectas. Solo 1 vez por partida" style="background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); color: #000; padding: 10px 18px; border-radius: 10px; font-size: 13px; font-weight: 800; cursor: pointer; border: none; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(255, 165, 0, 0.4);">
                    ‚ö° 50/50 (1 por partida)
                </button>
            </div>
        </div>
        
        <!-- PANTALLA ESPERANDO TURNO -->
        <div id="waitingTurnScreen" class="screen">
            <h1 style="color: #ffffff;">‚è≥ Esperando turno...</h1>
            <p style="text-align: center; font-size: 22px; color: rgba(255, 255, 255, 0.95); margin: 25px 0;">
                <strong id="otherPlayerName"></strong> est√° respondiendo
            </p>
            <div style="text-align: center; margin: 40px 0;">
                <div style="display: inline-block; width: 100px; height: 100px; border: 8px solid rgba(255,255,255,0.2); border-top: 8px solid #e94560; border-radius: 50%; animation: spin 1s linear infinite;"></div>
            </div>
            <style>
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            </style>
        </div>
        
        <!-- PANTALLA RESULTADOS -->
        <div id="resultsScreen" class="screen">
            <h1>üèÜ ¬°Juego Terminado!</h1>
            <div id="finalScores"></div>
            <button class="btn-primary" onclick="location.reload()">üéÆ Nueva Partida</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.6.0/socket.io.min.js"></script>
    <script>
        var socket = io('https://trivial-kapuchi.onrender.com');
        var currentRoom = null;
        var playerName = '';
        var timeLeft = 15;
        var timerInterval = null;
        var hasAnswered = false;
        var currentQuestion = null;
        var fiftyFiftyUsed = false; // ‚Üê A√ëADIDO
        
        // CONFIGURACI√ìN MULTIJUGADOR
        var multiplayerRounds = 1;
        var multiplayerQuestionsPerRound = 15;
        
        function showMultiplayerConfig() {
            playerName = document.getElementById('playerName').value.trim();
            if (!playerName) {
                showError('Por favor escribe tu nombre');
                return;
            }
            showScreen('multiplayerConfigScreen');
        }
        
        function selectMultiplayerRounds(rounds) {
            multiplayerRounds = rounds;
            document.querySelectorAll('.config-btn[data-rounds]').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.querySelector('.config-btn[data-rounds="' + rounds + '"]').classList.add('selected');
            updateMultiplayerSummary();
        }
        
        function selectMultiplayerQuestions(questions) {
            multiplayerQuestionsPerRound = questions;
            document.querySelectorAll('.config-btn[data-questions]').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.querySelector('.config-btn[data-questions="' + questions + '"]').classList.add('selected');
            updateMultiplayerSummary();
        }
        
        function updateMultiplayerSummary() {
            var total = multiplayerRounds * multiplayerQuestionsPerRound;
            var time = Math.ceil(total * 0.4);
            document.getElementById('multiplayerTotalQuestions').textContent = total;
            document.getElementById('multiplayerEstimatedTime').textContent = time;
        }
        
        function createRoomWithConfig() {
            socket.emit('createRoom', { 
                playerName: playerName,
                totalRounds: multiplayerRounds,
                questionsPerRound: multiplayerQuestionsPerRound
            });
        }
        
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(function(s) {
                s.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }
        
        function showError(message) {
            document.getElementById('errorContainer').innerHTML = '<div class="error">' + message + '</div>';
            setTimeout(function() {
                document.getElementById('errorContainer').innerHTML = '';
            }, 3000);
        }
        
        function showJoinScreen() {
            showScreen('joinScreen');
        }
        
        function joinRoom() {
            playerName = document.getElementById('playerName2').value.trim();
            var roomCode = document.getElementById('roomCodeInput').value.trim().toUpperCase();
            
            if (!playerName || !roomCode) {
                showError('Por favor completa todos los campos');
                return;
            }
            socket.emit('joinRoom', { roomCode: roomCode, playerName: playerName });
        }
        
        function markReady() {
            socket.emit('playerReady', currentRoom);
        }
        
        function submitAnswer(index) {
            if (hasAnswered) return;
            hasAnswered = true;
            clearInterval(timerInterval);
            
            window.selectedAnswerIndex = index;
            
            socket.emit('submitAnswer', {
                roomCode: currentRoom,
                answerIndex: index,
                timeLeft: timeLeft
            });
        }
        
        // SOCKET EVENTS
        socket.on('roomCreated', function(data) {
            currentRoom = data.roomCode;
            document.getElementById('roomCodeDisplay').textContent = data.roomCode;
            document.getElementById('playersList').innerHTML = '<div class="player">' + playerName + ' (T√∫)</div>';
            showScreen('waitingScreen');
        });
        
        socket.on('roomError', function(message) {
            showError(message);
        });
        
        socket.on('playerJoined', function(data) {
            currentRoom = data.roomCode;
            document.getElementById('roomCodeDisplay').textContent = data.roomCode;
            var html = '';
            data.players.forEach(function(p) {
                var readyText = p.ready ? ' ‚úì' : '';
                var className = p.ready ? 'player ready' : 'player';
                html += '<div class="' + className + '">' + p.name + readyText + '</div>';
            });
            document.getElementById('playersList').innerHTML = html;
            document.getElementById('playerCount').textContent = data.players.length;
            showScreen('waitingScreen');
        });
        
        socket.on('playersUpdate', function(players) {
            var html = '';
            players.forEach(function(p) {
                var readyText = p.ready ? ' ‚úì' : '';
                var className = p.ready ? 'player ready' : 'player';
                html += '<div class="' + className + '">' + p.name + readyText + '</div>';
            });
            document.getElementById('playersList').innerHTML = html;
            document.getElementById('playerCount').textContent = players.length;
        });
        
        socket.on('newQuestion', function(data) {
            currentQuestion = data;
            hasAnswered = false;
            timeLeft = 15;
            
            // Guardar √≠ndice correcto para el 50/50
            currentQuestion.correct = data.correctAnswer !== undefined ? data.correctAnswer : 0;
            
            // Actualizar bot√≥n 50/50
            var btn = document.getElementById('fiftyFiftyBtn');
            if (multiplayerQuestionsPerRound >= 10) {
                document.querySelector('.powerup-container').style.display = 'block';
                if (fiftyFiftyUsed) {
                    btn.disabled = true;
                    btn.textContent = '‚úì Usado';
                    btn.style.opacity = '0.5';
                } else {
                    btn.disabled = false;
                    btn.textContent = '‚ö° 50/50 (1 por partida)';
                    btn.style.opacity = '1';
                }
            } else {
                document.querySelector('.powerup-container').style.display = 'none';
            }
            
            var roundText = data.totalRounds > 1 ? 'üîÑ RONDA ' + data.currentRound + '/' + data.totalRounds + ' ¬∑ ' : '';
            document.getElementById('questionNumber').textContent = roundText + 'Pregunta ' + data.questionNumber + ' de ' + data.totalQuestions;
            
            // Actualizar marcador en vivo si hay datos de jugadores
            if (data.allPlayers && data.allPlayers.length > 0) {
                updateLiveScoreboard(data.allPlayers);
            }
            
            document.getElementById('questionText').textContent = data.question;
            document.getElementById('timer').textContent = timeLeft;
            
            var grid = document.getElementById('optionsGrid');
            grid.innerHTML = '';
            data.options.forEach(function(option, index) {
                var btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = option;
                btn.onclick = function() { submitAnswer(index); };
                grid.appendChild(btn);
            });
            
            showScreen('gameScreen');
            
            clearInterval(timerInterval);
            timerInterval = setInterval(function() {
                timeLeft--;
                document.getElementById('timer').textContent = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    if (!hasAnswered) {
                        hasAnswered = true;
                        socket.emit('nextQuestion', currentRoom);
                    }
                }
            }, 1000);
        });
        
        socket.on('answerResult', function(data) {
            var options = document.querySelectorAll('.option-btn');
            var selectedIndex = window.selectedAnswerIndex;
            if (selectedIndex !== undefined && options[selectedIndex]) {
                options[selectedIndex].classList.add('selected');
                if (data.isCorrect) {
                    options[selectedIndex].classList.add('correct');
                } else {
                    options[selectedIndex].classList.add('wrong');
                }
            }
        });
        
        socket.on('waitingTurn', function(data) {
            document.getElementById('otherPlayerName').textContent = data.currentPlayerName;
            
            // Actualizar marcador en vivo
            if (data.allPlayers && data.allPlayers.length > 0) {
                var html = '<div style="padding: 15px; background: rgba(255,255,255,0.1); border-radius: 12px; margin: 20px 0;">';
                html += '<h4 style="color: #fff; margin-bottom: 10px;">üìä Puntuaciones:</h4>';
                
                var sorted = data.allPlayers.sort((a, b) => b.score - a.score);
                sorted.forEach(function(p) {
                    var isCurrent = p.name === data.currentPlayerName;
                    html += '<div style="padding: 8px; margin: 5px 0; background: rgba(255,255,255,' + (isCurrent ? '0.2' : '0.05') + '); border-radius: 8px; border-left: 3px solid ' + (isCurrent ? '#e94560' : '#667eea') + ';">';
                    html += '<strong style="color: #fff;">' + p.name + (isCurrent ? ' üéØ' : '') + ':</strong> ';
                    html += '<span style="color: #FFD700; font-weight: 900;">' + p.score + ' pts</span>';
                    html += '</div>';
                });
                html += '</div>';
                
                var waitingDiv = document.getElementById('otherPlayerName').parentElement;
                var existing = waitingDiv.querySelector('.scores-display');
                if (existing) existing.remove();
                var div = document.createElement('div');
                div.className = 'scores-display';
                div.innerHTML = html;
                waitingDiv.appendChild(div);
            }
            
            showScreen('waitingTurnScreen');
        });
        
        function useFiftyFifty() {
            if (fiftyFiftyUsed || hasAnswered) return;
            
            fiftyFiftyUsed = true;
            document.getElementById('fiftyFiftyBtn').disabled = true;
            document.getElementById('fiftyFiftyBtn').textContent = '‚úì Usado';
            document.getElementById('fiftyFiftyBtn').style.opacity = '0.5';
            
            var options = document.querySelectorAll('.option-btn');
            var correctIndex = currentQuestion.correct || 0;
            var incorrectIndices = [];
            
            for (var i = 0; i < options.length; i++) {
                if (i !== correctIndex) {
                    incorrectIndices.push(i);
                }
            }
            
            // Eliminar 2 incorrectas aleatoriamente
            var toRemove = [];
            while (toRemove.length < 2 && incorrectIndices.length > 0) {
                var randomIndex = Math.floor(Math.random() * incorrectIndices.length);
                toRemove.push(incorrectIndices[randomIndex]);
                incorrectIndices.splice(randomIndex, 1);
            }
            
            toRemove.forEach(function(index) {
                options[index].style.display = 'none';
            });
        }
        
        function updateLiveScoreboard(players) {
            var html = '<div style="display: flex; justify-content: space-around; gap: 10px; flex-wrap: wrap;">';
            
            players.forEach(function(p) {
                var isMe = p.name === playerName;
                html += '<div style="flex: 1; min-width: 120px; text-align: center;">';
                html += '<div style="color: rgba(255,255,255,0.9); font-size: 13px; font-weight: 700; margin-bottom: 4px;">';
                html += (isMe ? 'üë§ ' : 'üë• ') + p.name;
                html += '</div>';
                html += '<div style="color: #FFD700; font-size: 15px; font-weight: 900;">';
                html += p.score + ' pts';
                html += '</div>';
                html += '</div>';
            });
            
            html += '</div>';
            document.getElementById('liveScoreboard').innerHTML = html;
        }
        
        socket.on('roundEnd', function(data) {
            var html = '<div style="text-align: center; padding: 10px;">';
            html += '<h2 style="color: #fff; margin: 20px 0;">üéØ FIN DE RONDA ' + data.currentRound + '/' + data.totalRounds + '</h2>';
            html += '<p style="color: rgba(255,255,255,0.8); margin: 15px 0;">Puntuaciones:</p>';
            
            data.ranking.forEach(function(p, index) {
                var medal = index === 0 ? 'ü•á' : 'ü•à';
                html += '<div style="background: ' + (index === 0 ? 'linear-gradient(135deg, #FFD700, #FFA500)' : 'linear-gradient(135deg, #C0C0C0, #808080)') + '; color: white; padding: 15px; margin: 10px; border-radius: 15px;">';
                html += '<div style="font-size: 32px;">' + medal + '</div>';
                html += '<strong style="font-size: 20px;">' + p.name + '</strong><br>';
                html += '<span style="font-size: 24px;">' + p.score + ' pts</span>';
                html += '</div>';
            });
            
            html += '<p style="color: rgba(255,255,255,0.9); margin-top: 20px;">Preparando Ronda ' + (data.currentRound + 1) + '...</p>';
            html += '</div>';
            
            document.getElementById('finalScores').innerHTML = html;
            showScreen('resultsScreen');
        });
        
        socket.on('gameOver', function(data) {
            var html = '<div style="text-align: center; padding: 10px;">';
            html += '<h2 style="color: #fff; margin: 20px 0;">üèÜ RANKING FINAL</h2>';
            if (data.totalRounds > 1) {
                html += '<p style="color: rgba(255,255,255,0.8); margin-bottom: 15px;">' + data.totalRounds + ' rondas completadas</p>';
            }
            
            var medals = ['ü•á', 'ü•à', 'ü•â', '4¬∫'];
            data.ranking.forEach(function(p, index) {
                var colors = [
                    'linear-gradient(135deg, #FFD700, #FFA500)',
                    'linear-gradient(135deg, #C0C0C0, #808080)',
                    'linear-gradient(135deg, #CD7F32, #8B4513)',
                    'rgba(255,255,255,0.9)'
                ];
                
                html += '<div style="background: ' + colors[index] + '; color: ' + (index < 3 ? 'white' : '#333') + '; padding: 15px; margin: 10px; border-radius: 15px;">';
                html += '<div style="font-size: 32px;">' + medals[index] + '</div>';
                html += '<strong style="font-size: 20px;">' + p.name + '</strong><br>';
                html += '<span style="font-size: 24px;">' + p.score + ' pts</span>';
                html += '</div>';
            });
            
            html += '</div>';
            document.getElementById('finalScores').innerHTML = html;
            showScreen('resultsScreen');
        });
        
        socket.on('playerLeft', function(players) {
            if (players.length === 0) {
                showError('El otro jugador se desconect√≥');
                setTimeout(function() {
                    location.reload();
                }, 2000);
            }
        });
        
        socket.on('connect_error', function() {
            showError('Error de conexi√≥n');
        });
    </script>
</body>
</html>
